<!DOCTYPE html>
<html lang="en" style="font-size: 50px;">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="X-UA-Compatible" content="edge">
<meta name="viewport"
	content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>泡泡口红机</title>
<link rel="stylesheet" href="http://www.375nvd.cn/addons/junsion_winaward/public/css/game.css?v=1548035864">
<link rel="stylesheet" href="http://www.375nvd.cn/addons/junsion_winaward/public/css/kouhong.css?v=1548035864">
<link rel="stylesheet" href="http://www.375nvd.cn/addons/junsion_winaward/public/css/index.css?v=1548035864">
<script>
var sysGame = '{"bgmusic":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/background_audio.mp3","insert":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/insert_audio.mp3","noinsert":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/collision_audio.wav","suc":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/success_audio.mp3","gamesuc":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/gameSuccess_audio.mp3","time":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/Countdown_10s_audio.mp3","timebg":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/timebox_bg.png","bg":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/bg.jpg","Lip":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/Sword_small_gray.png","bot":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/level_Switch_bottom.png","close":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/close_btn.jpg","time1":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/1.png","time2":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/2.png","time3":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/3.png","time4":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/4.png","time5":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/5.png","time6":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/6.png","time7":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/7.png","time8":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/8.png","time9":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/9.png","time0":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/0.png","0":{"bg":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/CircleCenter_1.png","lbg":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/CircleCenter_1_split_left.png","rbg":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/CircleCenter_1_split_right.png","switch":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/level_1Switch_main.png","level":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/level_icon_1_active.png","Lip1":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/Lipstick_1.png","Lip2":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/Sword_small_1.png"},"1":{"bg":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/CircleCenter_2.png","lbg":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/CircleCenter_2_split_left.png","rbg":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/CircleCenter_2_split_right.png","switch":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/level_2Switch_main.png","level":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/level_icon_2_active.png","level1":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/level_icon_2.png","Lip1":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/Lipstick_2.png","Lip2":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/Sword_small_2.png"},"2":{"bg":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/CircleCenter_3.png","lbg":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/CircleCenter_3_split_left.png","rbg":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/CircleCenter_3_split_right.png","switch":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/level_3Switch_main.png","level":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/level_icon_3_active.png","level1":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/level_icon_3.png","Lip1":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/Lipstick_3.png","Lip2":"http:\/\/www.375nvd.cn\/addons\/junsion_winaward\/public\/img\/Sword_small_3.png"}}';
sysGame = JSON.parse(sysGame);
var goodGame = '[{"num":"6","hard":"1","time":"30","speed_arr":[-0.03,0.02,0.01,-0.01,0.03,0.02,0.01]},{"num":"10","hard":"1","time":"40","speed_arr":[-0.03,0.02,0.01,-0.01,0.03,0.02,0.01]},{"num":13,"hard":3,"time":50,"speed_arr":[-0.08,-0.06,-0.04,0.03,0.05,0.07,0.09]}]';
goodGame = JSON.parse(goodGame);
var nowMid = "";
var nowOid = "";
var poid = "";
var indexUrl = "http://www.375nvd.cn/app/index.php?i=1&c=entry&do=index&m=junsion_winaward";
var logId = 0;
var tmpTotalLevel = 3;
if(nowMid && nowMid>0) tmpTotalLevel = 4;
var initUrl = "http://www.375nvd.cn/app/index.php?i=1&c=entry&do=checkRes&m=junsion_winaward";
var nowWindow = "2";
var wxTip = "";
var r_msg = '领取奖品';
var appUrl = "http://www.375nvd.cn/app/index.php?i=1&c=entry&do=order&m=junsion_winaward";
var levelStr = '';
var sparams = 0;
var isAddRecored = 0;
var gameobj = null;
</script>
<script src="http://www.375nvd.cn/addons/junsion_winaward/public/js/JicemoonMobileTouch.js?v=1548035864"></script>
<script src="http://www.375nvd.cn/addons/junsion_winaward/public/js/HardestGame-min.js?v=1548035864"></script>
<script src="/js/index-min.js"></script>
<script type="text/javascript" src="http://www.375nvd.cn/addons/junsion_winaward/public/js/bodymovin.js?v=1548035864"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js"></script>
<script type="text/javascript" src="http://www.375nvd.cn/addons/junsion_winaward/public/js/jquery-3.3.1.min.js?v=1548035864"></script>
<script type="text/javascript" src="http://www.375nvd.cn/addons/junsion_winaward/public/js/jquery.cookie.js?v=1548035864"></script>
<script type="text/javascript" src="http://www.375nvd.cn/addons/junsion_winaward/public/js/layer.js"></script>
</head>
<style>
* {
    -webkit-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
}
html{
  -webkit-tap-highlight-color: transparent;
}
img {
   pointer-events: none;
  -webkit-pointer-events: none;
  -ms-pointer-events: none;
  -moz-pointer-events: none;
}
a{
	text-decoration-line: none;
}
.wx_no,.g_tip{
    font-size: 15px;
    display: block;
    text-align: center;
    color:#333333;
    text-decoration-line: none;
}
.wx_no>span{
	font-size: 22px;
	color:#ff27a4;
}
.weui-mask{
    z-index: 99;
}
.modal-dialog {
    top: 20%;
    border-radius: 4px;
    box-shadow: 0 0 15px var(--wx_color);
    position: fixed;
left: 0;
z-index: 110;
width: 80%;
text-align: center;
background: #fff;
padding: 20px 5%;
margin-left: 5%;
}
.double_tip{
text-align: center;
font-size: 15px;
color:#333;
}
.double_tip>span{
font-size: 20px;
color:#ff27a4;
}
</style>
<body style="--wx_color:#ff27a4;--wx_color1:#ff27a4;--wx_color2:#fff1f4;">
<audio id="back_music" src="http://www.375nvd.cn/addons/junsion_winaward/public/img/background_audio.mp3" loop="true"></audio>
<audio id="collision_audio" src="http://www.375nvd.cn/addons/junsion_winaward/public/img/collision_audio.wav"></audio>
<audio id="Countdown_10s_audio" src="http://www.375nvd.cn/addons/junsion_winaward/public/img/Countdown_10s_audio.mp3"></audio>
<audio id="gameSuccess_audio" src="http://www.375nvd.cn/addons/junsion_winaward/public/img/gameSuccess_audio.mp3"></audio>
<audio id="insert_audio" src="http://www.375nvd.cn/addons/junsion_winaward/public/img/insert_audio.mp3"></audio>
<audio id="success_audio" src="http://www.375nvd.cn/addons/junsion_winaward/public/img/success_audio.mp3"></audio>
<div class="levelSwitchBox" id="levelSwitchBox">
    <img id="levelSwitchBoxMain" class="levelSwitchBoxMain"
        src="http://www.375nvd.cn/addons/junsion_winaward/public/img/level_1Switch_main.png"> <img
        class="levelSwitchBoxBottom" src="http://www.375nvd.cn/addons/junsion_winaward/public/img/level_Switch_bottom.png">
</div>
<div class="PopupBox" id="gameOverBox" style="height: auto;display: none;">
    <div id="gameOverClose" class="close">
        <img src="http://www.375nvd.cn/addons/junsion_winaward/public/img/close_btn.jpg">
    </div>
    <div id="gameOverBoxTitle">挑战失败</div>
            <div class="PopupBoxBtn" id='gamereplay' onclick='onRePlay()' style="margin-top:0.2rem;display: none;">付费复活(金币)</div>
        <div class="PopupBoxBtn" id="gameOverBoxBtn" style="margin-top:0.8rem;">返回</div>
        <a class="g_tip level_tip" style="display: none;width:80%;margin-left:10%;"></a>
                <div style="height:0.2rem;"></div>
</div>
<div class="PopupBox" id="gameSuccessBox" style="height: auto;display: none;">
    <div id="gameSuccessClose" class="close">
        <img src="http://www.375nvd.cn/addons/junsion_winaward/public/img/close_btn.jpg">
    </div>
    <div id="gameSuccessBoxText">体验结束</div>
    <div class="PopupBoxBtn" id="gameSuccessBoxBtn">开始挑战</div>
        <div style="height:0.2rem;"></div>
</div>
<div class="PopupBox" id="gameOverMsgBox" style="display: none;">
    <div id="gameMsgClose" class="close">
        <img src="http://www.375nvd.cn/addons/junsion_winaward/public/img/close_btn.jpg">
    </div>
    <div id="gameSuccessMsgText" style="font-size:16px;width: 60%;margin-left: 20%;line-height: 20px;"></div>
    <div class="PopupBoxBtn" id="gameOverMsgBtn"></div>
</div>
<div class="js_dialog" id="showModal4" style="display:none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog modal-dialog">
            <div class="weui-dialog_hd kh_none">泡泡赢口红收银台</div>
                        <div class="weui-dialog_bd">
                <div class="modal-body">
                    <div class="modal-kh_box">
                        <div class="modal_zpic">
                           当前金币：
                            <div class="modal_pic"><span id="memCredit">0</span></div>
                        </div>
                        <div class="kh_grids" id="kh_grids">
                                                        <div class="kh_grids-item kh_pics" onclick="checkChannel(0,6)">
                                <div class="kh_grids_pic" style="line-height:25px;">6 金币 <br /> 6 元
                                    <text></text>
                                </div>
                            </div>
                                                        <div class="kh_grids-item kh_pics" onclick="checkChannel(1,18)">
                                <div class="kh_grids_pic" style="line-height:25px;">18 金币 <br /> 18 元
                                    <text></text>
                                </div>
                            </div>
                                                        <div class="kh_grids-item kh_pics" onclick="checkChannel(2,36)">
                                <div class="kh_grids_pic" style="line-height:25px;">36 金币 <br /> 36 元
                                    <text></text>
                                </div>
                            </div>
                                                        <div class="kh_grids-item kh_pics" onclick="checkChannel(3,58)">
                                <div class="kh_grids_pic" style="line-height:25px;">58 金币 <br /> 58 元
                                    <text></text>
                                </div>
                            </div>
                                                        <div class="kh_grids-item kh_pics" onclick="checkChannel(4,72)">
                                <div class="kh_grids_pic" style="line-height:25px;">72 金币 <br /> 72 元
                                    <text></text>
                                </div>
                            </div>
                                                        <div class="kh_grids-item kh_pics" onclick="checkChannel(5,156)">
                                <div class="kh_grids_pic" style="line-height:25px;">156 金币 <br /> 156 元
                                    <text></text>
                                </div>
                            </div>
                                                    </div>
                    </div>
                </div>
            </div>
            <div class="weui-dialog_ft">
            </div>
        </div>
</div>	

    <div class="js_dialog" id="showModal5" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog modal-dialog" style="width:70%; padding:10px; z-index:9999; left: 50%; -webkit-transform: translate(-50%, -50%); transform: translate(-50%, -50%); top: 41%;margin-left:0;">
            <div class="weui-dialog_hd kh_none" style="font-size:20px;">请选择你的支付方式</div>
            <div class="weui-dialog_bd">
                <div class="modal-body">
                    <div class="modal-kh_box" style="padding:0;">
                        <div class="kh_grids" id="kh_grids">
                            <input type="hidden" id="pay_k" />
                            <input type="hidden" id="pay_m" />
                                                        <div class="kh_pics" onclick="goRecharge('1', 'http://www.375nvd.cn')" style="float: left; position: relative; width: 50%; z-index: 0; text-align: center; padding:0; border:0;">
                                <img src="http://www.375nvd.cn/addons/junsion_winaward/public/img/pay_1.png"  style="width:50%; height:auto; margin:0 auto; padding:0;"/>
                            </div>
                                                        <div class="kh_pics" onclick="goRecharge('2', 'http://www.u1hk3y.cn')" style="float: left; position: relative; width: 50%; z-index: 0; text-align: center; padding:0; border:0;">
                                <img src="http://www.375nvd.cn/addons/junsion_winaward/public/img/pay_2.png"  style="width:50%; height:auto; margin:0 auto; padding:0;"/>
                            </div>
                                                    </div>
                    </div>
                </div>
            </div>
            <div class="weui-dialog_ft">
            </div>
        </div>
    </div>

    <div class="js_dialog" id="showModal6" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog modal-dialog" style="width:70%; padding:10px; z-index:9999; left: 50%; -webkit-transform: translate(-50%, -50%); transform: translate(-50%, -50%); top: 41%;margin-left:0;">
            <div class="weui-dialog_hd kh_none" style="font-size:16px;">是否已支付完成？</div>
            <div class="weui-dialog_bd">
                <div class="modal-body">
                    <div class="modal-kh_box" style="padding:0; margin-top:30px;">
                        <div class="kh_grids" id="kh_grids">
                            <a href="#" id="refresh_url" style="font-size:13px; color:#fff; background:#ff27a4; border:0; border-radius:5px; padding:5px; width: 80%;display: block; text-align: center; margin:0 auto;">刷新</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="weui-dialog_ft">
            </div>
        </div>
    </div>


<div class="layoutRoot" id="app" style="background: url(http://www.375nvd.cn/addons/junsion_winaward/public/img/bg.jpg);background-size: cover;background-repeat: no-repeat;">
    <div class="game" id="game" style="width: 375px; height: 667px;">
        <canvas style="position: relative; z-index: 3" id="gameStage"
            width="375" height="667"></canvas>
        <div id="bm" style="width: 100%; height: 100%; position: fixed; background-color: rgba(0, 0, 0, 0); top: 5.3rem; transform: translate(-5%, -1%); z-index: 2">
        </div>
        <div class="tips">
            <p id="currentLevel">
                当前关数: <span>1</span>
            </p>
            <p id="gameTip"></p>
        </div>

        <div class="levelbox" id="levelbox">
            <div class="level">
                <img id="level_1" src="http://www.375nvd.cn/addons/junsion_winaward/public/img/level_icon_1_active.png">
            </div>
            <div class="level">
                <img id="level_2" src="http://www.375nvd.cn/addons/junsion_winaward/public/img/level_icon_2.png">
            </div>
            <div class="level">
                <img id="level_3" src="http://www.375nvd.cn/addons/junsion_winaward/public/img/level_icon_3.png">
            </div>
        </div>
        <div id="timebox" style="background: url(http://www.375nvd.cn/addons/junsion_winaward/public/img/timebox_bg.png);background-size: contain;background-repeat: no-repeat;">24</div>
    </div>
</div>
<script type="text/javascript">

var app_token = '';
var browser = {  
    versions: function() {  
        var u = navigator.userAgent, app = navigator.appVersion;  
        return {//移动终端浏览器版本信息   
            ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端  
            android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器  
            iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者QQHD浏览器  
            iPad: u.indexOf('iPad') > -1, //是否iPad  
        };  
    }(),  
    language: (navigator.browserLanguage || navigator.language).toLowerCase()  
} 
if ((browser.versions.ios || browser.versions.iPhone || browser.versions.iPad) && app_token) {
    window.webkit.messageHandlers.HomeButtonShow.postMessage({});
} else if (app_token && browser.versions.android) { 
    app.show();
}


	var screenWidth = $(window).width();
	var screenHeight = $(window).height();
	$('#game').css('width',screenWidth);
	$('#game').css('height',screenHeight);
		document.body.addEventListener('touchmove', function(e) {
			e.preventDefault(); //阻止默认的处理方式(阻止下拉滑动的效果)
		}, {
			passive : false
		}); //passive 参数不能省略，用来兼容ios和android
		var baseUrl = function GetRequest() {
			var url = location.search; //获取url中"?"符后的字符串
			var theRequest = new Object();
			if (url.indexOf("?") != -1) {
				url = url.split("?")[1];
				strs = url.split("&");
				for (var i = 0; i < strs.length; i++) {
					theRequest[strs[i].split("=")[0]] = (strs[i].split("=")[1]);
				}
			}
			return theRequest;
		}
		var jsonParamsAlias = baseUrl();

		var gameIntGameStartData = {
			"user_id" : jsonParamsAlias.uid,
			"game_prefix" : jsonParamsAlias.prefix,
			"randomNum" : jsonParamsAlias.rand,
			"product_id" : jsonParamsAlias.pid,
			"game_pay" : jsonParamsAlias.pay
		}

		var jsonParams = {
			"game_id" : jsonParamsAlias.gid,
			"game_pay" : jsonParamsAlias.pay,
			"product_id" : jsonParamsAlias.pid,
			"randomNum" : jsonParamsAlias.rand,
			"game_result" : jsonParamsAlias.res,
			"user_id" : jsonParamsAlias.uid
		}
		var cookieDelTime = new Date(Math.floor(new Date(
				new Date().getTime() + 150000)));
		$.cookie('game_cookie', null);
		$.cookie('game_cookie', JSON.stringify(jsonParams), {
			expires : cookieDelTime
		});
		var anim = bodymovin.loadAnimation({
			wrapper : document.querySelector('#bm'),
			animType : 'svg',
			loop : false,
			autoplay : false,
			prerender : true,
			path : '/other/data.json'
		});
		function play() {
			anim.goToAndStop(0, true)
			anim.play()
		}
		document.addEventListener('DOMContentLoaded', function() {
			audioAutoPlay('back_music');
		});
		function audioAutoPlay(obj) {
			var audio = document.getElementById(obj);
			audio.play();
			document.addEventListener("WeixinJSBridgeReady", function() {
				audio.play();
			}, false);
		}
		function audioAutoPlay1(obj) {
			wx.config({
				debug : false,
				appId : '',
				timestamp : 1,
				nonceStr : '',
				signature : '',
				jsApiList : []
			});
			wx.ready(function() {
				document.getElementById(obj).pause()
				document.getElementById(obj).play();
			});
		}
		document.addEventListener('visibilitychange', function(e) {
			function audioStop() {
				var audio = document.getElementById('back_music');
				document.hidden ? audio.pause() : audio.play();
				document.addEventListener("WeixinJSBridgeReady", function() {
					document.hidden ? audio.pause() : audio.play();
				}, false);
			}
			audioStop();
		});

                var mCredit = "0";
        var gPrice  = "";
        var gid     = "";
        var rechargeMoney = 0;
        var reOrderid = 0;
        var reGameTime = 0;
        var iscreateorder = false;
        function onRePlay(){
        	alert('付费复活')
            $.ajax({
                type:'post',
                url:"./index.php?i=1&c=entry&do=MemDetail&m=junsion_winaward",
                data:{gid: gid},
                success:function(data){
                    data = JSON.parse(data);
                    if(parseInt(data.credit) < parseInt(gPrice)){
                        // 余额不足，需要充值
                        //var lastMoney = parseFloat(gPrice) - parseFloat(mCredit);
                        //$('#rechargeMoney').text(lastMoney);
                        $("#memCredit").html(data.credit);
                        $('#showModal4').show();
                    }
                    else{
                        // 余额充足，直接扣款
                        // cNewGame(0);
                        doFight(gid, gPrice);
                    }

                },error:function(){
                    layer.msg('网络错误，请刷新重试');
                }
            });
        }

        function doFight(gid, price) {
        	console.log(2)
            if(iscreateorder) return false;
            iscreateorder = true;
            var layerIndex = layer.load(2, {shade: 0}); 
            $.ajax({
                type:'post',
                url:"./index.php?i=1&c=entry&do=CreateOrder&m=junsion_winaward",
                data:{id: gid},
                success:function(data){
                    iscreateorder = false;
                    layer.close(layerIndex); 
                    layer.closeAll();
                    data = JSON.parse(data);
                    if(data.code==1){
                        var memCredit = $('#memCredit').text();
                        var lastCredit = parseFloat(memCredit) - parseFloat(price);
                        $('#memCredit').text(lastCredit);
                        
                        var url = "./index.php?i=1&c=entry&isapp=2&do=game&m=junsion_winaward&oid="+data.oid+'&mid='+data.mid;
                        var layerIndex = layer.load(2, {shade: 0}); 
                        location.href = url;
                        layer.close(layerIndex); 
                    }
                    else if(data.code==2){
                        var $showModal3 = $('#showModal3');
                        $showModal3.fadeIn(200);
                    }
                    else{
                        layer.msg(data.msg);
                    }                   
                },error:function(){
                    layer.msg('网络错误，请刷新重试');
                }
            });
        }

    // 选择支付渠道
    function checkChannel(k, price) {
        // 如果支付渠道超出一个
                    $("#pay_k").val(k);
            $("#pay_m").val(price);
            $("#gameOverBox").fadeOut(100);
            $("#showModal4").fadeOut(100);
            $("#showModal5").fadeIn(200);
            }

    var orderid = 0;
    var rechargeMoney = 0;
    function goRecharge(psType, psUrl){
    	console.log(3)
        var index = $("#pay_k").val();
        var money = $("#pay_m").val();
        if(!money || money<=0){
            layer.msg('储值金额错误，请重新选择');
            return false;
        }
        rechargeMoney = money;
        var layerIndex = layer.load(2, {shade: 0}); 
        psUrl = encodeURI(psUrl);

        $("#showModal5").fadeOut(200);
        $("#showModal6").fadeIn(1000); // 应用于返回后不刷新页面的机型

        $.ajax({
            type:'post',
            url:"/app/index.php?i=1&c=entry&do=CreateRecharge&ppktk=&ppkhs=&ppkht=&m=junsion_winaward",
            data:{op: 'app',rIndex: index, psType:psType, poid:0},
            success:function(data){
                layer.close(layerIndex); 
                data = JSON.parse(data);
                console.log(data)
                if(data.code==1){
                    var json = data.res;
                    orderid = json.orderid;
                    WeixinJSBridge.invoke('getBrandWCPayRequest', json, function (res) {
                          if (res.err_msg === "get_brand_wcpay_request:ok") {
                              checkorder();
                          } else {
                              layer.msg('支付失败')
                          }
                      });
                }
                else if(data.code==2){

                    // 弹出刷新层
                    $("#refresh_url").attr('href', "./index.php?i=1&c=entry&do=game&m=junsion_winaward&oid="+data.newid+"&poid="+data.poid+"&mid="+1591386);

                    var ccurl = data.url;
                    if (data.psType == 1) {
                        ccurl = data.url + '&referer='+data.psUrl;
                    }
                    var changeurl = data.psUrl+"/app/index.php?i=1&c=entry&do=changeurl&lastToken=&lastTime=&churl="+encodeURIComponent(ccurl)+"&m=junsion_winaward";

                    if ((browser.versions.ios || browser.versions.iPhone || browser.versions.iPad) && app_token) {
                        window.webkit.messageHandlers.HomeButtonShow.postMessage({y:'300'});
                    } else if (app_token && browser.versions.android) { 
                        app.show();
                    }
                    location.href = changeurl;
                }
                else if(data.code==3){
                    var url = "./index.php?i=1&c=entry&do=pays&m=junsion_winaward&price="+data.price+'&orderid='+data.orderid+'&rurl='+data.url;
                    location.href = url;
                }
                else{
                    layer.msg(data.msg);
                }
            },
            error:function(){
                layer.msg('网络错误，请刷新重试');
            }
        });
    }



        function cNewGame(rtype, rIndex){
        	console.log(4)
            var layerIndex = layer.load(2, {shade: 0});
            $.ajax({
                url:"./index.php?i=1&c=entry&do=reorder&m=junsion_winaward",
                type:'post',
                data:{rIndex: rIndex},
                success:function(res){
                    layer.close(layerIndex); 
                    res = JSON.parse(res);
                    if(res.code > 0){
                        if(rtype == 0){
                            reGame(res.orderid, res.code);
                        }
                        else{
                            console.log(res);
                            if(res.code==1){
                                var json = res.res;
                                reOrderid = json.orderid;
                                WeixinJSBridge.invoke('getBrandWCPayRequest', json, function (res) {
                                      if (res.err_msg === "get_brand_wcpay_request:ok") {
                                          checkorder();
                                      } else {
                                          console.log(JSON.stringify(res))
                                          layer.msg(JSON.stringify(res))
                                      }
                                  });
                            }
                            else if(res.code==2){
                                if(res.url) location.href = res.url;
                                else {
                                    $('#gamereplay').hide();
                                    $('#gamereplay').remove();  
                                }
                            }
                        }
                    }else layer.msg(res.msg);
                }
            });
        }
        function checkorder(){
        	console.log(1)
            var layerIndex = layer.load(2, {shade: 0}); 
            if(reOrderid > 0){
                $.ajax({
                     type:'POST',
                     data:{orderid: reOrderid},
                     url:'./index.php?i=1&c=entry&do=CheckRecharge&m=junsion_winaward',
                     success:function(data){
                          if(data > 0){
                              layer.close(layerIndex); 
                              reGame(data, 0);
                              $('#showModal4').hide();
                              layer.msg('储值成功！');
                          }else{     
                              setTimeout(function(){
                                  checkorder();
                              },1000);
                          }
                     }
                 });
            }
        }
        function reGame(reOid, reCode){
            nowOid = reOid;
            isAddRecored = 0;
            $(".is_err").css("display", "none"),
            $("#gameOverBox").css("display", "none"),
            gameobj.init(),
            $("#app").removeClass("blur");
            gameobj.gameStart(3);
            document.getElementById("currentLevel").getElementsByTagName("span")[0].innerHTML = 3
            $('#gamereplay').hide();
            reGameTime++;
            if(reCode == 2 || reGameTime>=3){
                $('#gamereplay').remove();  
            }
            mCredit = parseFloat(mCredit) + parseFloat(rechargeMoney) - parseFloat(gPrice);
            $('#memCredit').text(mCredit);
        }
        		
 //返回true，如果canvas在绘制的时候启用了硬件加速
 // 尽量采用此方法来判断是否开启了硬件加速
var c=document.getElementById("gameStage");
var ctx=c.getContext("2d");
console.log(ctx);
 //ctx.isHardwareAccelerated();

	</script>


<script>;</script>
<!--
<script type="text/javascript" src="http://www.u1hk3y.cn/app/index.php?i=1&c=utility&a=visit&do=showjs&m=junsion_winaward"></script>
-->
</body>
</html>
